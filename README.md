# نظام تسجيل رغبات الدفعة (GitHub Pages + Google Sheets)

واجهة بسيطة بدون سيرفرات تديرها أنت: الصفحة تستضاف على **GitHub Pages**،
أما التخزين والمنطق (السعة/القفل/منع تكرار رقم الجلوس) فمع Google Apps Script + Google Sheets.

> لا تحتاج لاستضافة سيرفر. كل ما عليك: إعداد ملف Google Sheet، نشر سكربت Apps Script كـ Web App، ثم وضع رابطه في `index.html`.

---

## 1) تجهيز Google Sheet

أنشئ Google Sheet باسم مناسب، مع ورقتين:

1. **Config** (إعداد السعات)
   - الصف 1 (عناوين): `Choice | Capacity`
   - أسفلها صفوف لكل رغبة:
     - مثال:

       | Choice | Capacity |
       | ------ | -------- |
       | مجموعة A | 30 |
       | مجموعة B | 25 |
       | مجموعة C | 20 |

2. **Submissions** (التسجيلات)
   - الصف 1 (عناوين): `Timestamp | Name | Seat | Choice`

> ملاحظة: إحفظ ID الشيت (الموجود في رابط الشيت بين `/d/` و`/edit`).

---

## 2) سكربت Google Apps Script

1. أدخل إلى **Extensions → Apps Script** من داخل الشيت، وأنشئ ملف سكربت جديد.
2. الصق محتوى الملف `apps_script.gs` كاملاً.
3. غيّر قيمة المتغير `SHEET_ID` داخل السكربت إلى ID شيتك.
4. من **Deploy → Test deployments** جرّب محليًا (اختياري).
5. من **Deploy → Manage deployments → New deployment**:
   - النوع: **Web app**
   - من يمكنه الوصول: **Anyone** (أو Anyone with the link)
   - الصلاحية: **Execute as Me**
6. بعد النشر ستحصل على **Web app URL** (ينتهي بـ `/exec`).

---

## 3) ضبط صفحة GitHub Pages

1. ارفع ملفات هذا المشروع (أو مجلد `docs/` حسب تفضيلك) إلى مستودع GitHub.
2. فعّل **GitHub Pages** من إعدادات الريبو ليخدم الفرع `main` أو مجلد `docs`.
3. افتح `index.html`، واستبدل قيمة:
   ```js
   window.APP_CONFIG = {
     ENDPOINT: "PASTE_YOUR_WEBAPP_URL_HERE"
   };
   ```
   برابط الويب‑آب الذي حصلت عليه من الخطوة السابقة.

> الآن أي طالب يفتح صفحة GitHub Pages سيستطيع التسجيل مباشرة.

---

## 4) كيف يعمل المنطق

- `doGet` يعيد قائمة الرغبات + السعات + عدد المحجوز.
- `doPost`:
  - يستخدم قفلًا `LockService` لمنع التضارب (سباق الحجز).
  - يرفض التكرار: إذا كان **Seat** موجودًا مسبقًا.
  - يتحقق من السعة قبل الإضافة. إن كانت مكتملة يعيد `FULL`.
  - إذا نجح، يضيف صفًا في `Submissions` ويعيد `ok:true`.

> الكود يضع رؤوس CORS للسماح للصفحة بالاتصال مباشرة من GitHub Pages.

---

## 5) تخصيصات سريعة

- غير أسماء الرغبات والسعات من ورقة **Config** فقط.
- لمنع تعديل غير المصرح لهم، لا تشارك رابط الشيت، شارك **الصفحة فقط**.
- يمكنك تنزيل بيانات التسجيل من تبويب **Submissions** متى شئت.

---

## 6) أمان وخصوصية

- الرقم القومي/الهاتف **غير مطلوبين** افتراضيًا. لا تجمع إلا ما تحتاجه.
- إذا أردت التحقق الأقوى، أضف منطقًا إضافيًا في السكربت (مثلا White-list للأرقام).

---

## 7) دعم اللغة

- الواجهة عربية، والاتجاه RTL، ويمكن تعديل النصوص من `index.html` و`script.js`.

بالتوفيق! ✨